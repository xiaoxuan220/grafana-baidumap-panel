{"version":3,"sources":["../src/baidumap.js"],"names":["_","L","MP","tileServers","url","attribution","subdomains","WorldMap","ctrl","mapContainer","circles","console","log","createMap","panel","ak","then","elementId","id","map","BMap","Map","centerAndZoom","Point","initialZoom","enableScrollWheelZoom","addControl","NavigationControl","ScaleControl","OverviewMapControl","MapTypeControl","legend","window","control","position","onAdd","_div","DomUtil","create","update","thresholds","data","legendHtml","colors","index","length","innerHTML","addTo","locations","sort","dataPoints","isEqual","filter","o","hideEmpty","isNil","value","hideZero","circlesLayer","clearLayers","removeCircles","filterEmptyAndZeroValues","needToRedrawCircles","clearCircles","createCircles","updateCircles","forEach","dataPoint","locationName","push","createCircle","addCircles","circle","find","cir","options","location","key","setRadius","calcCircleSize","setStyle","color","getColor","fillColor","fillOpacity","unbindPopup","createPopup","valueRounded","circleMarker","locationLatitude","locationLongitude","radius","dataPointValue","circleMinSize","parseInt","circleMaxSize","valueRange","dataFactor","lowestValue","circleSizeRange","unit","unitSingular","unitPlural","label","trim","bindPopup","point","stickyLabels","on","onMouseOver","evt","layer","target","bringToFront","openPopup","onMouseOut","closePopup","onClick","$","parseJSON","href","first","invalidateSize","panTo","parseFloat","latitude","longitude","mapCenterMoved","removeFrom","layerGroup","removeLayer","zoomFactor","setZoom","removeLegend","remove"],"mappings":";;;;;;;;;;;;;;;AAAOA,I;;AAEAC,I;;AAEEC,K,mBAAAA,E;;;;;;;;;;;;;;;;;;;;;AAEHC,c,GAAc;AACnB,wBAAqB;AACpBC,UAAM,8EADc;AAEpBC,kBAAc,wIAFM;AAGpBC,iBAAa;AAHO,KADF;AAMnB,oBAAiB;AAChBF,UAAM,6EADU;AAEhBC,kBAAc,wIAFE;AAGhBC,iBAAa;AAHG;AANE,I;;AAaCC,W;AACpB,sBAAYC,IAAZ,EAAkBC,YAAlB,EAAgC;AAAA;;AAC/B,UAAKD,IAAL,GAAYA,IAAZ;AACA,UAAKC,YAAL,GAAoBA,YAApB;AACA,UAAKC,OAAL,GAAe,EAAf;AACAC,aAAQC,GAAR,CAAYJ,IAAZ;AACA,YAAO,KAAKK,SAAL,EAAP;AACA;;;;iCAEW;AAAA;;AACXX,SAAG,KAAKM,IAAL,CAAUM,KAAV,CAAgBC,EAAnB,EAAuBC,IAAvB,CAA4B,gBAAQ;AACnC,WAAMC,YAAY,WAAW,MAAKT,IAAL,CAAUM,KAAV,CAAgBI,EAA7C;AACA,aAAKC,GAAL,GAAW,IAAIC,KAAKC,GAAT,CAAaJ,SAAb,CAAX;AACA,aAAKE,GAAL,CAASG,aAAT,CAAuB,IAAIF,KAAKG,KAAT,CAAe,OAAf,EAAwB,MAAxB,CAAvB,EAAwD,MAAKf,IAAL,CAAUM,KAAV,CAAgBU,WAAxE;AACA,aAAKL,GAAL,CAASM,qBAAT;AACA,aAAKN,GAAL,CAASO,UAAT,CAAoB,IAAIN,KAAKO,iBAAT,EAApB,EALmC,CAKgB;AACnD,aAAKR,GAAL,CAASO,UAAT,CAAoB,IAAIN,KAAKQ,YAAT,EAApB,EANmC,CAMW;AAC9C,aAAKT,GAAL,CAASO,UAAT,CAAoB,IAAIN,KAAKS,kBAAT,EAApB,EAPmC,CAOiB;AACpD,aAAKV,GAAL,CAASM,qBAAT,GARmC,CAQD;AAClC,aAAKN,GAAL,CAASO,UAAT,CAAoB,IAAIN,KAAKU,cAAT,EAApB,EATmC,CASa;AAChD,OAVD;AAWG;;;oCAEW;AAAA;;AACd,WAAKC,MAAL,GAAcC,OAAO/B,CAAP,CAASgC,OAAT,CAAiB;AAC9BC,iBAAW;AADmB,OAAjB,CAAd;AAGA,WAAKH,MAAL,CAAYI,KAAZ,GAAoB,YAAM;AACzB,cAAKJ,MAAL,CAAYK,IAAZ,GAAmBJ,OAAO/B,CAAP,CAASoC,OAAT,CAAiBC,MAAjB,CAAwB,KAAxB,EAA+B,aAA/B,CAAnB;AACA,cAAKP,MAAL,CAAYQ,MAAZ;AACA,cAAO,OAAKR,MAAL,CAAYK,IAAnB;AACA,OAJD;;AAMA,WAAKL,MAAL,CAAYQ,MAAZ,GAAqB,YAAM;AAC1B,WAAMC,aAAa,OAAKhC,IAAL,CAAUiC,IAAV,CAAeD,UAAlC;AACA,WAAIE,aAAa,EAAjB;AACAA,qBAAc,mDAAmD,OAAKlC,IAAL,CAAUM,KAAV,CAAgB6B,MAAhB,CAAuB,CAAvB,CAAnD,GAA+E,SAA/E,GACb,OADa,GACHH,WAAW,CAAX,CADG,GACa,QAD3B;AAEA,YAAK,IAAII,QAAQ,CAAjB,EAAoBA,QAAQJ,WAAWK,MAAvC,EAA+CD,SAAS,CAAxD,EAA2D;AAC1DF,sBAAc,mDAAmD,OAAKlC,IAAL,CAAUM,KAAV,CAAgB6B,MAAhB,CAAuBC,QAAQ,CAA/B,CAAnD,GAAuF,SAAvF,GACdJ,WAAWI,KAAX,CADc,IACOJ,WAAWI,QAAQ,CAAnB,IAAwB,YAAYJ,WAAWI,QAAQ,CAAnB,CAAZ,GAAoC,QAA5D,GAAuE,GAD9E,CAAd;AAEA;AACD,cAAKb,MAAL,CAAYK,IAAZ,CAAiBU,SAAjB,GAA6BJ,UAA7B;AACA,OAVD;AAWA,WAAKX,MAAL,CAAYgB,KAAZ,CAAkB,KAAK5B,GAAvB;AACA;;;yCAEmBsB,I,EAAM;AACzB,UAAI,KAAK/B,OAAL,CAAamC,MAAb,KAAwB,CAAxB,IAA6BJ,KAAKI,MAAL,GAAc,CAA/C,EAAkD,OAAO,IAAP;;AAElD,UAAI,KAAKnC,OAAL,CAAamC,MAAb,KAAwBJ,KAAKI,MAAjC,EAAyC,OAAO,IAAP;AACzC,UAAMG,YAAYhD,EAAEmB,GAAF,CAAMnB,EAAEmB,GAAF,CAAM,KAAKT,OAAX,EAAoB,SAApB,CAAN,EAAsC,UAAtC,EAAkDuC,IAAlD,EAAlB;AACA,UAAMC,aAAalD,EAAEmB,GAAF,CAAMsB,IAAN,EAAY,KAAZ,EAAmBQ,IAAnB,EAAnB;AACA,aAAO,CAACjD,EAAEmD,OAAF,CAAUH,SAAV,EAAqBE,UAArB,CAAR;AACA;;;8CAEwBT,I,EAAM;AAAA;;AAC9B,aAAOzC,EAAEoD,MAAF,CAASX,IAAT,EAAe,UAACY,CAAD,EAAO;AAC5B,cAAO,EAAE,OAAK7C,IAAL,CAAUM,KAAV,CAAgBwC,SAAhB,IAA6BtD,EAAEuD,KAAF,CAAQF,EAAEG,KAAV,CAA/B,KAAoD,EAAE,OAAKhD,IAAL,CAAUM,KAAV,CAAgB2C,QAAhB,IAA4BJ,EAAEG,KAAF,KAAY,CAA1C,CAA3D;AACA,OAFM,CAAP;AAGA;;;oCAEc;AACd,UAAI,KAAKE,YAAT,EAAuB;AACtB,YAAKA,YAAL,CAAkBC,WAAlB;AACA,YAAKC,aAAL,CAAmB,KAAKF,YAAxB;AACA,YAAKhD,OAAL,GAAe,EAAf;AACA;AACD;;;mCAEa;AACb,UAAM+B,OAAO,KAAKoB,wBAAL,CAA8B,KAAKrD,IAAL,CAAUiC,IAAxC,CAAb;AACA,UAAI,KAAKqB,mBAAL,CAAyBrB,IAAzB,CAAJ,EAAoC;AACnC,YAAKsB,YAAL;AACA,YAAKC,aAAL,CAAmBvB,IAAnB;AACA,OAHD,MAGO;AACN,YAAKwB,aAAL,CAAmBxB,IAAnB;AACA;AACD;;;mCAEaA,I,EAAM;AAAA;;AACnB,UAAM/B,UAAU,EAAhB;AACA+B,WAAKyB,OAAL,CAAa,UAACC,SAAD,EAAe;AAC3B,WAAI,CAACA,UAAUC,YAAf,EAA6B;AAC7B1D,eAAQ2D,IAAR,CAAa,OAAKC,YAAL,CAAkBH,SAAlB,CAAb;AACA,OAHD;AAIA,WAAKT,YAAL,GAAoB,KAAKa,UAAL,CAAgB7D,OAAhB,CAApB;AACA,WAAKA,OAAL,GAAeA,OAAf;AACA;;;mCAEa+B,I,EAAM;AAAA;;AACnBA,WAAKyB,OAAL,CAAa,UAACC,SAAD,EAAe;AAC3B,WAAI,CAACA,UAAUC,YAAf,EAA6B;;AAE7B,WAAMI,SAASxE,EAAEyE,IAAF,CAAO,OAAK/D,OAAZ,EAAqB,UAACgE,GAAD,EAAS;AAC5C,eAAOA,IAAIC,OAAJ,CAAYC,QAAZ,KAAyBT,UAAUU,GAA1C;AACA,QAFc,CAAf;;AAIA,WAAIL,MAAJ,EAAY;AACXA,eAAOM,SAAP,CAAiB,OAAKC,cAAL,CAAoBZ,UAAUX,KAAV,IAAmB,CAAvC,CAAjB;AACAgB,eAAOQ,QAAP,CAAgB;AACfC,gBAAQ,OAAKC,QAAL,CAAcf,UAAUX,KAAxB,CADO;AAEf2B,oBAAY,OAAKD,QAAL,CAAcf,UAAUX,KAAxB,CAFG;AAGf4B,sBAAc,GAHC;AAIfR,mBAAWT,UAAUU;AAJN,SAAhB;AAMAL,eAAOa,WAAP;AACA,eAAKC,WAAL,CAAiBd,MAAjB,EAAyBL,UAAUC,YAAnC,EAAiDD,UAAUoB,YAA3D;AACA;AACD,OAlBD;AAmBA;;;kCAEYpB,S,EAAW;AACvB,UAAMK,SAASxC,OAAO/B,CAAP,CAASuF,YAAT,CAAsB,CAAErB,UAAUsB,gBAAZ,EAA8BtB,UAAUuB,iBAAxC,CAAtB,EAAmF;AACjGC,eAAS,KAAKZ,cAAL,CAAoBZ,UAAUX,KAAV,IAAmB,CAAvC,CADwF;AAEjGyB,cAAQ,KAAKC,QAAL,CAAcf,UAAUX,KAAxB,CAFyF;AAGjG2B,kBAAY,KAAKD,QAAL,CAAcf,UAAUX,KAAxB,CAHqF;AAIjG4B,oBAAc,GAJmF;AAKjGR,iBAAWT,UAAUU;AAL4E,OAAnF,CAAf;;AAQA,WAAKS,WAAL,CAAiBd,MAAjB,EAAyBL,UAAUC,YAAnC,EAAiDD,UAAUoB,YAA3D;AACA,aAAOf,MAAP;AACA;;;oCAEcoB,c,EAAgB;AAC9B,UAAMC,gBAAgBC,SAAS,KAAKtF,IAAL,CAAUM,KAAV,CAAgB+E,aAAzB,EAAwC,EAAxC,KAA+C,CAArE;AACA,UAAME,gBAAgBD,SAAS,KAAKtF,IAAL,CAAUM,KAAV,CAAgBiF,aAAzB,EAAwC,EAAxC,KAA+C,EAArE;;AAEA,UAAI,KAAKvF,IAAL,CAAUiC,IAAV,CAAeuD,UAAf,KAA8B,CAAlC,EAAqC;AACpC,cAAOD,aAAP;AACA;;AAED,UAAME,aAAa,CAACL,iBAAiB,KAAKpF,IAAL,CAAUiC,IAAV,CAAeyD,WAAjC,IAAgD,KAAK1F,IAAL,CAAUiC,IAAV,CAAeuD,UAAlF;AACA,UAAMG,kBAAkBJ,gBAAgBF,aAAxC;;AAEA,aAAQM,kBAAkBF,UAAnB,GAAiCJ,aAAxC;AACA;;;iCAEWrB,M,EAAQJ,Y,EAAcZ,K,EAAO;AACxC,UAAM4C,OAAO5C,SAASA,UAAU,CAAnB,GAAuB,KAAKhD,IAAL,CAAUM,KAAV,CAAgBuF,YAAvC,GAAsD,KAAK7F,IAAL,CAAUM,KAAV,CAAgBwF,UAAnF;AACA,UAAMC,QAAQ,CAAC,WAAWnC,YAAX,GAA0B,IAA1B,GAAiCZ,KAAjC,GAAyC,GAAzC,IAAgD4C,QAAQ,EAAxD,CAAD,EAA8DI,IAA9D,EAAd;AACAhC,aAAOiC,SAAP,CAAiBF,KAAjB,EAAwB;AACvB,iBAAWvE,OAAO/B,CAAP,CAASyG,KAAT,CAAe,CAAf,EAAkB,CAAC,CAAnB,CADY;AAEvB,oBAAc,gBAFS;AAGvB,sBAAgB,KAAKlG,IAAL,CAAUM,KAAV,CAAgB6F;AAHT,OAAxB;;AAMAnC,aAAOoC,EAAP,CAAU,WAAV,EAAuB,SAASC,WAAT,CAAqBC,GAArB,EAA0B;AAChD,WAAMC,QAAQD,IAAIE,MAAlB;AACAD,aAAME,YAAN;AACA,YAAKC,SAAL;AACA,OAJD;;AAMA,UAAI,CAAC,KAAK1G,IAAL,CAAUM,KAAV,CAAgB6F,YAArB,EAAmC;AAClCnC,cAAOoC,EAAP,CAAU,UAAV,EAAsB,SAASO,UAAT,GAAsB;AAC3C3C,eAAO4C,UAAP;AACA,QAFD;AAGA;;AAED5C,aAAOoC,EAAP,CAAU,OAAV,EAAmB,SAASS,OAAT,CAAiBP,GAAjB,EAAsB;AACxC,WAAMC,QAAQD,IAAIE,MAAlB;AACAD,aAAME,YAAN;AACA;AACA;AACAtG,eAAQC,GAAR,CAAYwD,YAAZ;AACAzD,eAAQC,GAAR,CAAY0G,EAAEC,SAAF,CAAYnD,YAAZ,CAAZ;AACAQ,gBAAS4C,IAAT,GAAgB,YAAYpD,YAA5B;AACA,OARD;AASA;;;8BAEQZ,K,EAAO;AACf,WAAK,IAAIZ,QAAQ,KAAKpC,IAAL,CAAUiC,IAAV,CAAeD,UAAf,CAA0BK,MAA3C,EAAmDD,QAAQ,CAA3D,EAA8DA,SAAS,CAAvE,EAA0E;AACzE,WAAIY,SAAS,KAAKhD,IAAL,CAAUiC,IAAV,CAAeD,UAAf,CAA0BI,QAAQ,CAAlC,CAAb,EAAmD;AAClD,eAAO,KAAKpC,IAAL,CAAUM,KAAV,CAAgB6B,MAAhB,CAAuBC,KAAvB,CAAP;AACA;AACD;AACD,aAAO5C,EAAEyH,KAAF,CAAQ,KAAKjH,IAAL,CAAUM,KAAV,CAAgB6B,MAAxB,CAAP;AACA;;;8BAEQ;AACR,WAAKxB,GAAL,CAASuG,cAAT;AACA;;;sCAEgB;AAChB,WAAKvG,GAAL,CAASwG,KAAT,CAAe,CAAEC,WAAW,KAAKpH,IAAL,CAAUM,KAAV,CAAgB+G,GAA3B,CAAF,EAAmCD,WAAW,KAAKpH,IAAL,CAAUM,KAAV,CAAgBgH,GAA3B,CAAnC,CAAf;AACA,WAAKtH,IAAL,CAAUuH,cAAV,GAA2B,KAA3B;AACA;;;oCAEc;AACd,WAAKhG,MAAL,CAAYiG,UAAZ,CAAuB,KAAK7G,GAA5B;AACA,WAAKY,MAAL,GAAc,IAAd;AACA;;;gCAEUrB,O,EAAS;AACnB,aAAOsB,OAAO/B,CAAP,CAASgI,UAAT,CAAoBvH,OAApB,EAA6BqC,KAA7B,CAAmC,KAAK5B,GAAxC,CAAP;AACA;;;qCAEe;AACf,WAAKA,GAAL,CAAS+G,WAAT,CAAqB,KAAKxE,YAA1B;AACA;;;6BAEOyE,U,EAAY;AACnB,WAAKhH,GAAL,CAASiH,OAAT,CAAiBtC,SAASqC,UAAT,EAAqB,EAArB,CAAjB;AACA;;;8BAEQ;AACR,WAAKzH,OAAL,GAAe,EAAf;AACA,UAAI,KAAKgD,YAAT,EAAuB,KAAKE,aAAL;AACvB,UAAI,KAAK7B,MAAT,EAAiB,KAAKsG,YAAL;AACjB,WAAKlH,GAAL,CAASmH,MAAT;AACA;;;;;;sBAnNmB/H,Q","file":"baidumap.js","sourcesContent":["import _ from 'lodash';\n/* eslint-disable id-length, no-unused-vars */\nimport L from './libs/leaflet';\n/* eslint-disable id-length, no-unused-vars */\nimport { MP } from './libs/baidumap.js';  \n\nconst tileServers = {\n\t'CartoDB Positron' : {\n\t\turl : 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png',\n\t\tattribution : '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n\t\tsubdomains : 'abcd'\n\t},\n\t'CartoDB Dark' : {\n\t\turl : 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png',\n\t\tattribution : '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>',\n\t\tsubdomains : 'abcd'\n\t}\n};\n\nexport default class WorldMap {\n\tconstructor(ctrl, mapContainer) {\n\t\tthis.ctrl = ctrl;\n\t\tthis.mapContainer = mapContainer;\n\t\tthis.circles = [];\n\t\tconsole.log(ctrl);\n\t\treturn this.createMap();\n\t}\n\n\tcreateMap() {\n\t\tMP(this.ctrl.panel.ak).then(BMap => {\n\t\t\tconst elementId = \"mapid_\" + this.ctrl.panel.id;\n\t\t\tthis.map = new BMap.Map(elementId);\n\t\t\tthis.map.centerAndZoom(new BMap.Point(116.404, 39.915), this.ctrl.panel.initialZoom);\n\t\t\tthis.map.enableScrollWheelZoom();\n\t\t\tthis.map.addControl(new BMap.NavigationControl()); // 添加平移缩放控件\n\t\t\tthis.map.addControl(new BMap.ScaleControl()); // 添加比例尺控件\n\t\t\tthis.map.addControl(new BMap.OverviewMapControl()); //添加缩略地图控件\n\t\t\tthis.map.enableScrollWheelZoom(); //启用滚轮放大缩小\n\t\t\tthis.map.addControl(new BMap.MapTypeControl()); //添加地图类型控件\n\t\t})\n    }\n\n\tcreateLegend() {\n\t\tthis.legend = window.L.control({\n\t\t\tposition : 'bottomleft'\n\t\t});\n\t\tthis.legend.onAdd = () => {\n\t\t\tthis.legend._div = window.L.DomUtil.create('div', 'info legend');\n\t\t\tthis.legend.update();\n\t\t\treturn this.legend._div;\n\t\t};\n\n\t\tthis.legend.update = () => {\n\t\t\tconst thresholds = this.ctrl.data.thresholds;\n\t\t\tlet legendHtml = '';\n\t\t\tlegendHtml += '<div class=\"legend-item\"><i style=\"background:' + this.ctrl.panel.colors[0] + '\"></i> ' +\n\t\t\t\t'&lt; ' + thresholds[0] + '</div>';\n\t\t\tfor (let index = 0; index < thresholds.length; index += 1) {\n\t\t\t\tlegendHtml += '<div class=\"legend-item\"><i style=\"background:' + this.ctrl.panel.colors[index + 1] + '\"></i> ' +\n\t\t\t\tthresholds[index] + (thresholds[index + 1] ? '&ndash;' + thresholds[index + 1] + '</div>' : '+');\n\t\t\t}\n\t\t\tthis.legend._div.innerHTML = legendHtml;\n\t\t};\n\t\tthis.legend.addTo(this.map);\n\t}\n\n\tneedToRedrawCircles(data) {\n\t\tif (this.circles.length === 0 && data.length > 0) return true;\n\n\t\tif (this.circles.length !== data.length) return true;\n\t\tconst locations = _.map(_.map(this.circles, 'options'), 'location').sort();\n\t\tconst dataPoints = _.map(data, 'key').sort();\n\t\treturn !_.isEqual(locations, dataPoints);\n\t}\n\n\tfilterEmptyAndZeroValues(data) {\n\t\treturn _.filter(data, (o) => {\n\t\t\treturn !(this.ctrl.panel.hideEmpty && _.isNil(o.value)) && !(this.ctrl.panel.hideZero && o.value === 0);\n\t\t});\n\t}\n\n\tclearCircles() {\n\t\tif (this.circlesLayer) {\n\t\t\tthis.circlesLayer.clearLayers();\n\t\t\tthis.removeCircles(this.circlesLayer);\n\t\t\tthis.circles = [];\n\t\t}\n\t}\n\n\tdrawCircles() {\n\t\tconst data = this.filterEmptyAndZeroValues(this.ctrl.data);\n\t\tif (this.needToRedrawCircles(data)) {\n\t\t\tthis.clearCircles();\n\t\t\tthis.createCircles(data);\n\t\t} else {\n\t\t\tthis.updateCircles(data);\n\t\t}\n\t}\n\n\tcreateCircles(data) {\n\t\tconst circles = [];\n\t\tdata.forEach((dataPoint) => {\n\t\t\tif (!dataPoint.locationName) return;\n\t\t\tcircles.push(this.createCircle(dataPoint));\n\t\t});\n\t\tthis.circlesLayer = this.addCircles(circles);\n\t\tthis.circles = circles;\n\t}\n\n\tupdateCircles(data) {\n\t\tdata.forEach((dataPoint) => {\n\t\t\tif (!dataPoint.locationName) return;\n\n\t\t\tconst circle = _.find(this.circles, (cir) => {\n\t\t\t\treturn cir.options.location === dataPoint.key;\n\t\t\t});\n\n\t\t\tif (circle) {\n\t\t\t\tcircle.setRadius(this.calcCircleSize(dataPoint.value || 0));\n\t\t\t\tcircle.setStyle({\n\t\t\t\t\tcolor : this.getColor(dataPoint.value),\n\t\t\t\t\tfillColor : this.getColor(dataPoint.value),\n\t\t\t\t\tfillOpacity : 0.5,\n\t\t\t\t\tlocation : dataPoint.key,\n\t\t\t\t});\n\t\t\t\tcircle.unbindPopup();\n\t\t\t\tthis.createPopup(circle, dataPoint.locationName, dataPoint.valueRounded);\n\t\t\t}\n\t\t});\n\t}\n\n\tcreateCircle(dataPoint) {\n\t\tconst circle = window.L.circleMarker([ dataPoint.locationLatitude, dataPoint.locationLongitude ], {\n\t\t\tradius : this.calcCircleSize(dataPoint.value || 0),\n\t\t\tcolor : this.getColor(dataPoint.value),\n\t\t\tfillColor : this.getColor(dataPoint.value),\n\t\t\tfillOpacity : 0.5,\n\t\t\tlocation : dataPoint.key\n\t\t});\n\n\t\tthis.createPopup(circle, dataPoint.locationName, dataPoint.valueRounded);\n\t\treturn circle;\n\t}\n\n\tcalcCircleSize(dataPointValue) {\n\t\tconst circleMinSize = parseInt(this.ctrl.panel.circleMinSize, 10) || 2;\n\t\tconst circleMaxSize = parseInt(this.ctrl.panel.circleMaxSize, 10) || 30;\n\n\t\tif (this.ctrl.data.valueRange === 0) {\n\t\t\treturn circleMaxSize;\n\t\t}\n\n\t\tconst dataFactor = (dataPointValue - this.ctrl.data.lowestValue) / this.ctrl.data.valueRange;\n\t\tconst circleSizeRange = circleMaxSize - circleMinSize;\n\n\t\treturn (circleSizeRange * dataFactor) + circleMinSize;\n\t}\n\n\tcreatePopup(circle, locationName, value) {\n\t\tconst unit = value && value === 1 ? this.ctrl.panel.unitSingular : this.ctrl.panel.unitPlural;\n\t\tconst label = ('显示标签：：' + locationName + ': ' + value + ' ' + (unit || '')).trim();\n\t\tcircle.bindPopup(label, {\n\t\t\t'offset' : window.L.point(0, -2),\n\t\t\t'className' : 'worldmap-popup',\n\t\t\t'closeButton' : this.ctrl.panel.stickyLabels\n\t\t});\n\n\t\tcircle.on('mouseover', function onMouseOver(evt) {\n\t\t\tconst layer = evt.target;\n\t\t\tlayer.bringToFront();\n\t\t\tthis.openPopup();\n\t\t});\n\n\t\tif (!this.ctrl.panel.stickyLabels) {\n\t\t\tcircle.on('mouseout', function onMouseOut() {\n\t\t\t\tcircle.closePopup();\n\t\t\t});\n\t\t}\n\n\t\tcircle.on('click', function onClick(evt) {\n\t\t\tconst layer = evt.target;\n\t\t\tlayer.bringToFront();\n\t\t\t//this.openPopup();\n\t\t\t// console.log(this);\n\t\t\tconsole.log(locationName);\n\t\t\tconsole.log($.parseJSON(locationName));\n\t\t\tlocation.href = \"http://\" + locationName;\n\t\t});\n\t}\n\n\tgetColor(value) {\n\t\tfor (let index = this.ctrl.data.thresholds.length; index > 0; index -= 1) {\n\t\t\tif (value >= this.ctrl.data.thresholds[index - 1]) {\n\t\t\t\treturn this.ctrl.panel.colors[index];\n\t\t\t}\n\t\t}\n\t\treturn _.first(this.ctrl.panel.colors);\n\t}\n\n\tresize() {\n\t\tthis.map.invalidateSize();\n\t}\n\n\tpanToMapCenter() {\n\t\tthis.map.panTo([ parseFloat(this.ctrl.panel.latitude), parseFloat(this.ctrl.panel.longitude) ]);\n\t\tthis.ctrl.mapCenterMoved = false;\n\t}\n\n\tremoveLegend() {\n\t\tthis.legend.removeFrom(this.map);\n\t\tthis.legend = null;\n\t}\n\n\taddCircles(circles) {\n\t\treturn window.L.layerGroup(circles).addTo(this.map);\n\t}\n\n\tremoveCircles() {\n\t\tthis.map.removeLayer(this.circlesLayer);\n\t}\n\n\tsetZoom(zoomFactor) {\n\t\tthis.map.setZoom(parseInt(zoomFactor, 10));\n\t}\n\n\tremove() {\n\t\tthis.circles = [];\n\t\tif (this.circlesLayer) this.removeCircles();\n\t\tif (this.legend) this.removeLegend();\n\t\tthis.map.remove();\n\t}\n}"]}